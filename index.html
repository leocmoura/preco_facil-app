import React, { useState } from 'react';
import { Search, MapPin, Upload, TrendingUp, ShoppingCart, Star, Clock, DollarSign } from 'lucide-react';

const PrecoFacilApp = () => {
  const [activeTab, setActiveTab] = useState('buscar');
  const [searchTerm, setSearchTerm] = useState('');

  // Dados simulados
  const produtos = [
    {
      id: 1,
      nome: "Coca Cola 2L",
      menor_preco: 8.99,
      estabelecimentos: [
        { nome: "Atacad√£o Centro", preco: 8.99, distancia: "1.2km", ultima_atualizacao: "2h atr√°s" },
        { nome: "Extra Hiper", preco: 9.45, distancia: "2.1km", ultima_atualizacao: "4h atr√°s" },
        { nome: "Carrefour", preco: 10.20, distancia: "0.8km", ultima_atualizacao: "1h atr√°s" }
      ],
      meu_historico: [
        { data: "15/07", preco: 9.20, local: "Extra Hiper" },
        { data: "10/07", preco: 8.80, local: "Atacad√£o Centro" }
      ]
    },
    {
      id: 2,
      nome: "√ìleo de Soja 900ml",
      menor_preco: 4.25,
      estabelecimentos: [
        { nome: "Atacad√£o Centro", preco: 4.25, distancia: "1.2km", ultima_atualizacao: "1h atr√°s" },
        { nome: "Extra Hiper", preco: 4.89, distancia: "2.1km", ultima_atualizacao: "3h atr√°s" }
      ],
      meu_historico: [
        { data: "12/07", preco: 4.50, local: "Extra Hiper" }
      ]
    }
  ];

  const produtosFiltrados = produtos.filter(produto => 
    produto.nome.toLowerCase().includes(searchTerm.toLowerCase())
  );

  const TabButton = ({ id, label, icon: Icon, active }) => (
    <button
      onClick={() => setActiveTab(id)}
      className={`flex flex-col items-center p-3 rounded-lg transition-all ${
        active ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
      }`}
    >
      <Icon size={20} />
      <span className="text-xs mt-1">{label}</span>
    </button>
  );

  const BuscarTab = () => (
    <div className="space-y-4">
      <div className="relative">
        <Search className="absolute left-3 top-3 text-gray-400" size={20} />
        <input
          type="text"
          placeholder="Buscar produto (ex: Coca Cola, √ìleo...)"
          className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />
      </div>

      <div className="flex items-center gap-2 text-sm text-gray-600">
        <MapPin size={16} />
        <span>Mostrando produtos num raio de 5km - Bras√≠lia, DF</span>
      </div>

      <div className="space-y-4">
        {produtosFiltrados.map(produto => (
          <div key={produto.id} className="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
            <div className="flex justify-between items-start mb-3">
              <h3 className="font-semibold text-lg">{produto.nome}</h3>
              <div className="text-right">
                <div className="text-2xl font-bold text-green-600">R$ {produto.menor_preco.toFixed(2)}</div>
                <div className="text-xs text-gray-500">menor pre√ßo</div>
              </div>
            </div>

            <div className="space-y-2">
              {produto.estabelecimentos.map((est, idx) => (
                <div key={idx} className={`flex justify-between items-center p-2 rounded ${
                  idx === 0 ? 'bg-green-50 border border-green-200' : 'bg-gray-50'
                }`}>
                  <div>
                    <div className="font-medium">{est.nome}</div>
                    <div className="text-sm text-gray-600 flex items-center gap-2">
                      <MapPin size={12} />
                      {est.distancia}
                      <Clock size={12} />
                      {est.ultima_atualizacao}
                    </div>
                  </div>
                  <div className={`text-lg font-semibold ${
                    idx === 0 ? 'text-green-600' : 'text-gray-800'
                  }`}>
                    R$ {est.preco.toFixed(2)}
                  </div>
                </div>
              ))}
            </div>

            <div className="mt-3 pt-3 border-t border-gray-200">
              <div className="text-sm text-gray-600 mb-2">üìä Suas √∫ltimas compras:</div>
              <div className="flex gap-4 text-sm">
                {produto.meu_historico.map((hist, idx) => (
                  <div key={idx} className="bg-blue-50 px-2 py-1 rounded">
                    {hist.data}: R$ {hist.preco.toFixed(2)} ({hist.local})
                  </div>
                ))}
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );

  const NFTab = () => (
    <div className="space-y-6">
      <div className="text-center">
        <Upload size={48} className="mx-auto text-blue-600 mb-4" />
        <h2 className="text-xl font-semibold mb-2">Adicionar Nota Fiscal</h2>
        <p className="text-gray-600 mb-6">
          Ajude a comunidade mantendo os pre√ßos atualizados! 
          Carregue sua NF eletr√¥nica e automaticamente atualizaremos os pre√ßos.
        </p>
      </div>

      <div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors cursor-pointer">
        <Upload size={32} className="mx-auto text-gray-400 mb-3" />
        <p className="text-gray-600 mb-2">Clique para enviar ou arraste sua NF aqui</p>
        <p className="text-sm text-gray-500">Formatos aceitos: XML, PDF, JPG, PNG</p>
      </div>

      <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h3 className="font-semibold text-blue-800 mb-2">Como funciona:</h3>
        <ul className="text-sm text-blue-700 space-y-1">
          <li>‚Ä¢ Envie sua nota fiscal de compras</li>
          <li>‚Ä¢ Nosso sistema extrai automaticamente os produtos e pre√ßos</li>
          <li>‚Ä¢ Os dados s√£o validados e adicionados ao banco de pre√ßos</li>
          <li>‚Ä¢ Voc√™ ganha pontos que podem ser trocados por descontos</li>
        </ul>
      </div>

      <div className="bg-green-50 border border-green-200 rounded-lg p-4">
        <div className="flex items-center gap-2 mb-2">
          <Star className="text-yellow-500" size={20} />
          <span className="font-semibold">Seus Pontos: 2,450</span>
        </div>
        <p className="text-sm text-green-700">
          Continue enviando NFs para ganhar mais pontos e trocar por benef√≠cios!
        </p>
      </div>
    </div>
  );

  const HistoricoTab = () => (
    <div className="space-y-4">
      <h2 className="text-xl font-semibold flex items-center gap-2">
        <TrendingUp className="text-blue-600" />
        Hist√≥rico de Compras
      </h2>

      <div className="bg-white border border-gray-200 rounded-lg p-4">
        <h3 className="font-semibold mb-3">√öltimas 30 dias</h3>
        <div className="space-y-3">
          <div className="flex justify-between items-center p-3 bg-gray-50 rounded">
            <div>
              <div className="font-medium">Compra no Atacad√£o Centro</div>
              <div className="text-sm text-gray-600">15/07/2025 - 23 itens</div>
            </div>
            <div className="text-right">
              <div className="font-semibold">R$ 342,80</div>
              <div className="text-xs text-green-600">‚Üì 8% vs m√©dia</div>
            </div>
          </div>

          <div className="flex justify-between items-center p-3 bg-gray-50 rounded">
            <div>
              <div className="font-medium">Compra no Extra Hiper</div>
              <div className="text-sm text-gray-600">10/07/2025 - 18 itens</div>
            </div>
            <div className="text-right">
              <div className="font-semibold">R$ 289,45</div>
              <div className="text-xs text-red-600">‚Üë 12% vs m√©dia</div>
            </div>
          </div>
        </div>
      </div>

      <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h3 className="font-semibold text-blue-800 mb-2">Insights das suas compras:</h3>
        <ul className="text-sm text-blue-700 space-y-1">
          <li>‚Ä¢ Voc√™ economiza em m√©dia R$ 45 por compra usando o app</li>
          <li>‚Ä¢ Atacad√£o Centro oferece os melhores pre√ßos para 78% dos seus produtos</li>
          <li>‚Ä¢ Coca Cola 2L: melhor dia para comprar √© ter√ßa-feira</li>
        </ul>
      </div>
    </div>
  );

  return (
    <div className="max-w-md mx-auto bg-gray-50 min-h-screen">
      {/* Header */}
      <div className="bg-blue-600 text-white p-4">
        <h1 className="text-xl font-bold">Pre√ßo F√°cil</h1>
        <p className="text-blue-100 text-sm">Compare pre√ßos em tempo real</p>
      </div>

      {/* Content */}
      <div className="p-4 pb-20">
        {activeTab === 'buscar' && <BuscarTab />}
        {activeTab === 'nf' && <NFTab />}
        {activeTab === 'historico' && <HistoricoTab />}
      </div>

      {/* Bottom Navigation */}
      <div className="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white border-t border-gray-200 p-4">
        <div className="flex justify-around">
          <TabButton 
            id="buscar" 
            label="Buscar" 
            icon={Search} 
            active={activeTab === 'buscar'} 
          />
          <TabButton 
            id="nf" 
            label="Adicionar NF" 
            icon={Upload} 
            active={activeTab === 'nf'} 
          />
          <TabButton 
            id="historico" 
            label="Hist√≥rico" 
            icon={ShoppingCart} 
            active={activeTab === 'historico'} 
          />
        </div>
      </div>
    </div>
  );
};

export default PrecoFacilApp;